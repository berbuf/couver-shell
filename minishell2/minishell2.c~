/*
** minishell2.c for 42sh in /home/hedia_m/couver-shell/minishell2
** 
** Made by mohamed-laid hedia
** Login   <hedia_m@epitech.net>
** 
** Started on  Fri May 20 21:09:32 2016 mohamed-laid hedia
** Last update Sun May 22 16:28:52 2016 mohamed-laid hedia
*/

#include "mo.h"

void		do_process(char **tab, char **env, t_command *s, t_pipe *p)
{
  int		t;
  int		f;
  char		*b;

  if ((t = fork()) == -1)
    return ;
  else if (t == 0)
    {
      if (dup2(p->p[p->i % 2][1], 1) == -1)
	return ((void)fprintf(2, "%s\n", strerror(errno)));
      if (p->i != 0)
	if (dup2(p->p[p->i % 2 ? 0 : 1][0], 0) == -1)
	  return ((void)fprintf(2, "%s\n", strerror(errno)));
      close(p->p[p->i % 2][0]);
      b = ;
      minishell1(tab, &env);
    }
  close(p->p[p->i % 2][1]);
}

void		pipe_execution(char **tab, char **env, t_command *s)
{
  t_pipe	p;

  p.i = 0;
  while (next_is_pipe(tab, s->i))
    {
      if (pipe(p.p[i % 2]) == -1)
	return ((void)fprintf(2, "%s\n", strerror(errno)));
    }
}

void		the_execution(char **tab, char **env)
{
  t_command	s;

  s.i = 0;
  if ((s.save[0] = dup(0)) == -1 || (s.save[1] = dup(1)) == -1)
    return ((void)fprintf(2, "%s\n", strerror(errno)));
  while (tab[i] != 0)
    {
      if (next_is_pipe(tab, s.i))
	pipe_executon(tab, env, &s);
      else if (!strcmp(";", tab[s.i]))
	s.i++;
      else
	normal_execution(tab, env, &s);
    }
}
